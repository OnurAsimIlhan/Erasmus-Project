<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      crossorigin="anonymous"
    />

    <title>{% block title %}View Aplications{% endblock %}</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar">
        <div class="navbar-nav">
          <form method="POST">
          <a class="nav-item nav-link" href="/ec/home">Home</a>
          </form>
          {% for role in user.role %}
          {% if role.role == "Course Coordinator" %}
            <a class="nav-item nav-link" href="/cchome">Switch to Course Coordinator</a>
          {% endif %}
          {% endfor %}
          <a class="nav-item nav-link" href="/">Upload Final Form</a>
          <a class="nav-item nav-link" href="/faq/update/department={{user_service.getUserById(user.bilkent_id).department}}">Update FAQ</a>
          <a class="nav-item nav-link" href="/ec/applications">View Student Applications</a>
          <a class="nav-item nav-link" href="/ec/application_period/create/department={{user.department}}">Open Application Period</a>
          <a class="nav-item nav-link" href="/ec/universities">Universities</a>
          <a class="nav-item nav-link" href="/ec/courses">View Course Proposals</a>
          <a class="nav-item nav-link" href="/logout">Logout</a>
        </div>
      </div>
    </nav>
    <h2> Application Periods </h2>
    <table class="table table-bordered table-striped">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Department</th>
            <th scope="col">Status</th>
            <th scope="col">Selected</th>
          </tr>
        </thead>
        
        <tbody>
          <form method="POST">
            {% for application_period in application_period_service.getApplicationPeriodsByDepartment(
              user_service.getUserById(user.bilkent_id).department) 
            %}
            <tr>
              <td>{{application_period.title}}</td>
              <td>{{application_period.department}}</td>
              <td>{{application_period.status}}</td>
              <td>
                {% if application_period.id == application_period_id|int %}
                <input 
                  type="radio" 
                  style="width: 15px; height: 15px;"
                  name="application_period_id"
                  value={{application_period.id}}
                  checked
                >
                {% else %}
                <input 
                  type="radio" 
                  style="width: 15px; height: 15px;"
                  name="application_period_id"
                  value={{application_period.id}}
                >
                {% endif %}
              </td>
            </tr>
            {% endfor %}
            <button name="application_period_get" value="True" class="btn btn-primary">Select Period</button>
          </form>
        </tbody>
      </table>
      <h2> Application List </h2>
      <table class="table table-bordered table-striped">
        <thead class="thead-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Student ID</th>
            <th scope="col">Application Status</th>
            <th scope="col">Check Details</th>
          </tr>
        </thead>
        <tbody>
          {% if application_period_id != None %}
          {% for application in applications_service.getApplicationsByApplicationPeriodId(
            application_period_id) 
          %}
          <tr>
            <td>{{application.application_id}}</td>
            <td>{{application.student_id}}</td>
            <td>{{application.application_status}}</td>
            <td>
              <form method="POST">
              {% if application.application_status == "waiting preapproval approval" or application.application_status == "waiting learning agreement approval" %}
                <button type="submit" class="open" name="download" value="{{ application.application_id }}">
                  Download
                </button>
                <button type="submit" class="open" name="approve" value="{{ application.application_id }}">
                  Approve
                </button>
                <button type="submit" class="open" name="reject" value="{{ application.application_id }}">
                  Reject
                </button>
              {% elif application.application_status == "waiting bin" %}
                <select class="form-control" id ="select_university" name="select_university">
                  {% for university, department in university_dictionary.items() %}
                    {% if department.remaining_quota|int != 0 %}
                      <option value="{{ university.name }}">{{ university.name }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
                <button type="submit" class="open" name="place" value="{{ application.application_id }}">
                  Place
                </button>
              {% else %}
                <button type="submit" class="open" name="download" value="{{ application.application_id }}">
                  Download Latest Form
                </button>
              {% endif %}
            </form>
            </td>
          </tr>
          {% endfor %}
          {% endif %}
        </tbody>
      </table>
    
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </body>
</html>